# Internationalization (i18n)

Statigo provides built-in internationalization support with URL-based language routing and JSON translation files.

## Overview

- URL-based language routing (`/en/about`, `/tr/hakkinda`)
- JSON translation files with dot notation
- Automatic hreflang links for SEO
- Language detection from browser preferences
- Cookie-based language persistence

## Setup

### 1. Create Translation Files

Place translation files in `translations/`:

```
translations/
├── en.json
├── tr.json
└── de.json
```

### 2. Configure Supported Languages

```go
languages := []string{"en", "tr", "de"}
```

### 3. Initialize i18n

```go
i18nInstance, err := i18n.New(translationsFS, "en")
```

The second parameter is the default language.

## Translation Files

### Structure

Use dot notation for nested keys:

```json
{
  "nav": {
    "home": "Home",
    "about": "About"
  },
  "pages": {
    "home": {
      "title": "Welcome",
      "heading": "Hello World"
    }
  }
}
```

### Access Translations

```go
// Get raw value
value := i18nInstance.GetRaw("en", "pages.home.title")
// Returns "Welcome"

// Get string
text := i18nInstance.Get("en", "pages.home.heading")
// Returns "Hello World"
```

## In Templates

### Using the `t` Function

```html
<h1>{{t .Lang "pages.home.heading"}}</h1>
```

### With Default Values

```html
<p>{{t .Lang "pages.home.description" "Default description"}}</p>
```

### Nested Keys

```html
<a href="/about">{{t .Lang "nav.about"}}</a>
```

## URL Structure

Each language has its own URL path:

| Language | URL Pattern | Example        |
| -------- | ----------- | -------------- |
| English  | `/en/*`     | `/en/about`    |
| Turkish  | `/tr/*`     | `/tr/hakkinda` |
| German   | `/de/*`     | `/de/uber`     |

### Route Configuration

```json
{
  "canonical": "/about",
  "paths": {
    "en": "/en/about",
    "tr": "/tr/hakkinda",
    "de": "/de/uber"
  }
}
```

## Language Detection

### Detection Order

1. **URL path** - Explicit language in URL
2. **Cookie** - Previously selected language
3. **Accept-Language** - Browser preference
4. **Default** - Configured fallback

### Cookie

Set by the language middleware:

```http
Set-Cookie: lang=en; Path=/; Max-Age=31536000; HttpOnly; SameSite=Lax
```

### Browser Detection

Parses `Accept-Language` header:

```
Accept-Language: tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7
```

Will prefer: tr → tr-TR → en-US → en → default

## Language Switcher

### Template Implementation

```html
<div class="lang-switcher">
  {{- $urls := alternateURLs .Canonical}} {{- range $lang, $url := $urls}}
  <a href="{{$url}}" class="lang-link{{if eq $lang $.Lang}} active{{end}}">
    {{$lang}}
  </a>
  {{- end}}
</div>
```

### Result

```html
<div class="lang-switcher">
  <a href="/en/about" class="lang-link active">en</a>
  <a href="/tr/hakkinda" class="lang-link">tr</a>
  <a href="/de/uber" class="lang-link">de</a>
</div>
```

## SEO Features

### Canonical URLs

Each language gets its own canonical URL:

```html
<link rel="canonical" href="https://example.com/en/about" />
```

### Hreflang Links

Alternate language links for search engines:

```html
<link rel="alternate" hreflang="en" href="https://example.com/en/about" />
<link rel="alternate" hreflang="tr" href="https://example.com/tr/hakkinda" />
<link
  rel="alternate"
  hreflang="x-default"
  href="https://example.com/en/about"
/>
```

### Template Functions

```html
{{canonicalURL .Canonical .Lang}} {{alternateLinks .Canonical}} {{alternateURLs
.Canonical}} {{pathForLanguage .Canonical "tr"}}
```

## Language Middleware Configuration

```go
config := middleware.LanguageConfig{
    SupportedLanguages: []string{"en", "tr", "de"},
    DefaultLanguage:    "en",
    SkipPaths:          []string{"/robots.txt", "/sitemap.xml"},
    SkipPrefixes:       []string{"/health/", "/static/", "/api/"},
}

r.Use(middleware.Language(i18nInstance, config))
```

### Skip Paths

Paths that skip language detection:

```go
SkipPaths: []string{
    "/robots.txt",
    "/sitemap.xml",
    "/favicon.ico",
}
```

### Skip Prefixes

Path prefixes that skip language detection:

```go
SkipPrefixes: []string{
    "/health/",    // Health endpoints
    "/static/",    // Static assets
    "/api/",       // API endpoints
    "/webhook/",   // Webhooks
}
```

## Adding a New Language

### 1. Create Translation File

```bash
cp translations/en.json translations/de.json
```

### 2. Translate Content

```json
{
  "nav": {
    "home": "Startseite",
    "about": "Über uns"
  }
}
```

### 3. Update Routes

```json
{
  "canonical": "/about",
  "paths": {
    "en": "/en/about",
    "tr": "/tr/hakkinda",
    "de": "/de/uber"
  }
}
```

### 4. Update main.go

```go
languages := []string{"en", "tr", "de"}
```

### 5. Update Middleware Config

```go
config := middleware.LanguageConfig{
    SupportedLanguages: []string{"en", "tr", "de"},
    // ...
}
```

## Best Practices

1. **Use English keys** - Keep translation keys in English
2. **Organize by feature** - Group related translations
3. **Use dot notation** - Keep nested structure logical
4. **Provide defaults** - Use default values in templates
5. **Test all languages** - Verify each language version
6. **Keep translations in sync** - Add new keys to all language files

## Example: Complete Translation File

```json
{
  "branding": {
    "name": "My App",
    "tagline": "Built with Statigo"
  },
  "nav": {
    "home": "Home",
    "about": "About",
    "contact": "Contact"
  },
  "footer": {
    "copyright": "© 2024 My App. All rights reserved.",
    "powered_by": "Powered by Statigo"
  },
  "pages": {
    "home": {
      "title": "Welcome to My App",
      "description": "A fast, modern web application",
      "heading": "Hello, World!",
      "cta": "Get Started"
    },
    "about": {
      "title": "About Us",
      "heading": "About My App",
      "description": "Learn more about what we do"
    }
  },
  "errors": {
    "not_found": {
      "title": "Page Not Found",
      "message": "The page you're looking for doesn't exist.",
      "action": "Go Home"
    }
  }
}
```

## Troubleshooting

### Translations Not Showing

1. Check translation file is in `translations/` directory
2. Verify file is valid JSON
3. Check language code matches file name (e.g., `en.json`)
4. Ensure i18n instance is passed to renderer

### Wrong Language Showing

1. Clear language cookie
2. Check URL path has language prefix
3. Verify middleware configuration
4. Check browser Accept-Language header

### Missing Translation Keys

1. Add key to all translation files
2. Use default values in templates
3. Check for typos in key names
